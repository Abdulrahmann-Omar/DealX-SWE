{"ast":null,"code":"import React,{useEffect,useState}from'react';import{useNavigate}from'react-router-dom';import{useUser}from'./UserContext';// Import the context\nimport axios from'axios';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ProfilePage=()=>{const{user}=useUser();// Access user data from context (this should contain logged-in user data)\nconst[profile,setProfile]=useState(null);const[editMode,setEditMode]=useState(false);const[formData,setFormData]=useState({});const[error,setError]=useState(null);const navigate=useNavigate();console.log(user);// Fetch profile data on component mount\nuseEffect(()=>{const fetchProfile=async()=>{try{// If the user data exists in the context, skip the request.\nif(user){setProfile(user);setFormData(user);}else{const response=await axios.get('http://localhost:5000/api/profile',{headers:{Authorization:`Bearer ${localStorage.getItem('token')}`}});setProfile(response.data.user);// Set profile data\nsetFormData(response.data.user);// Set form data for editing\n}}catch(err){var _err$response;if(((_err$response=err.response)===null||_err$response===void 0?void 0:_err$response.status)===401){setError('Unauthorized: Please log in.');navigate('/login');}else{setError('An error occurred while fetching profile data.');}}};fetchProfile();},[navigate,user]);// Runs whenever navigate or user context changes\nconst handleInputChange=e=>{const{name,value}=e.target;setFormData({...formData,[name]:value});};const handleUpdateProfile=async()=>{try{const response=await axios.put(`/api/profile/${profile.id}`,formData,{withCredentials:true,headers:{Authorization:`Bearer ${localStorage.getItem('token')}`}});alert('Profile updated successfully');setProfile(formData);// Update profile data after successful update\nsetEditMode(false);}catch(error){console.error('Error updating profile:',error);alert('Failed to update profile. Please try again.');}};const handleDeleteProfile=async()=>{if(window.confirm('Are you sure you want to delete your profile?')){try{await axios.delete(`/api/profile/${profile.id}`,{withCredentials:true,headers:{Authorization:`Bearer ${localStorage.getItem('token')}`}});alert('Profile deleted successfully');navigate('/login');// Redirect to login after successful profile deletion\n}catch(error){console.error('Error deleting profile:',error);alert('Failed to delete profile. Please try again.');}}};if(error)return/*#__PURE__*/_jsx(\"div\",{children:error});// Show any error messages\nreturn/*#__PURE__*/_jsxs(\"div\",{className:\"profile-container\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"profile-heading\",children:\"My Profile\"}),/*#__PURE__*/_jsx(\"div\",{className:\"profile-card\",children:!editMode?/*#__PURE__*/_jsxs(\"div\",{className:\"profile-view\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Username:\"}),\" \",profile===null||profile===void 0?void 0:profile.username]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Email:\"}),\" \",profile===null||profile===void 0?void 0:profile.email]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Full Name:\"}),\" \",profile===null||profile===void 0?void 0:profile.full_name]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Address:\"}),\" \",profile===null||profile===void 0?void 0:profile.address]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Phone Number:\"}),\" \",profile===null||profile===void 0?void 0:profile.phone_number]}),/*#__PURE__*/_jsxs(\"div\",{className:\"button-group\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn edit-btn\",onClick:()=>setEditMode(true),children:\"Edit Profile\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn delete-btn\",onClick:handleDeleteProfile,children:\"Delete Profile\"})]})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"profile-edit\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"username\",value:formData.username||'',onChange:handleInputChange,placeholder:\"Username\",className:\"form-input\"}),/*#__PURE__*/_jsx(\"input\",{type:\"email\",name:\"email\",value:formData.email||'',onChange:handleInputChange,placeholder:\"Email\",className:\"form-input\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"full_name\",value:formData.full_name||'',onChange:handleInputChange,placeholder:\"Full Name\",className:\"form-input\"}),/*#__PURE__*/_jsx(\"textarea\",{name:\"address\",value:formData.address||'',onChange:handleInputChange,placeholder:\"Address\",className:\"form-textarea\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"phone_number\",value:formData.phone_number||'',onChange:handleInputChange,placeholder:\"Phone Number\",className:\"form-input\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"button-group\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn save-btn\",onClick:handleUpdateProfile,children:\"Save Changes\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn cancel-btn\",onClick:()=>setEditMode(false),children:\"Cancel\"})]})]})})]});};export default ProfilePage;","map":{"version":3,"names":["React","useEffect","useState","useNavigate","useUser","axios","jsx","_jsx","jsxs","_jsxs","ProfilePage","user","profile","setProfile","editMode","setEditMode","formData","setFormData","error","setError","navigate","console","log","fetchProfile","response","get","headers","Authorization","localStorage","getItem","data","err","_err$response","status","handleInputChange","e","name","value","target","handleUpdateProfile","put","id","withCredentials","alert","handleDeleteProfile","window","confirm","delete","children","className","username","email","full_name","address","phone_number","onClick","type","onChange","placeholder"],"sources":["C:/Users/Abdu Omar/Desktop/SWE/DealX-SWE/frontend/src/ProfilePage.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useUser } from './UserContext'; // Import the context\r\nimport axios from 'axios';\r\n\r\nconst ProfilePage = () => {\r\n    const { user } = useUser(); // Access user data from context (this should contain logged-in user data)\r\n    const [profile, setProfile] = useState(null);\r\n    const [editMode, setEditMode] = useState(false);\r\n    const [formData, setFormData] = useState({});\r\n    const [error, setError] = useState(null);\r\n    const navigate = useNavigate();\r\n    console.log(user)\r\n    // Fetch profile data on component mount\r\n    useEffect(() => {\r\n        const fetchProfile = async () => {\r\n            try {\r\n                // If the user data exists in the context, skip the request.\r\n                if (user) {\r\n                    setProfile(user); \r\n                    setFormData(user); \r\n                } else {\r\n                    const response = await axios.get('http://localhost:5000/api/profile', {\r\n                        headers: { Authorization: `Bearer ${localStorage.getItem('token')}` },\r\n                    });\r\n                    setProfile(response.data.user); // Set profile data\r\n                    setFormData(response.data.user); // Set form data for editing\r\n                }\r\n            } catch (err) {\r\n                if (err.response?.status === 401) {\r\n                    setError('Unauthorized: Please log in.');\r\n                    navigate('/login');\r\n                } else {\r\n                    setError('An error occurred while fetching profile data.');\r\n                }\r\n            }\r\n        };\r\n\r\n        fetchProfile();\r\n    }, [navigate, user]); // Runs whenever navigate or user context changes\r\n\r\n    const handleInputChange = (e) => {\r\n        const { name, value } = e.target;\r\n        setFormData({ ...formData, [name]: value });\r\n    };\r\n\r\n    const handleUpdateProfile = async () => {\r\n        try {\r\n            const response = await axios.put(`/api/profile/${profile.id}`, formData, {\r\n                withCredentials: true,\r\n                headers: { Authorization: `Bearer ${localStorage.getItem('token')}` },\r\n            });\r\n            alert('Profile updated successfully');\r\n            setProfile(formData); // Update profile data after successful update\r\n            setEditMode(false);\r\n        } catch (error) {\r\n            console.error('Error updating profile:', error);\r\n            alert('Failed to update profile. Please try again.');\r\n        }\r\n    };\r\n\r\n    const handleDeleteProfile = async () => {\r\n        if (window.confirm('Are you sure you want to delete your profile?')) {\r\n            try {\r\n                await axios.delete(`/api/profile/${profile.id}`, {\r\n                    withCredentials: true,\r\n                    headers: { Authorization: `Bearer ${localStorage.getItem('token')}` },\r\n                });\r\n                alert('Profile deleted successfully');\r\n                navigate('/login'); // Redirect to login after successful profile deletion\r\n            } catch (error) {\r\n                console.error('Error deleting profile:', error);\r\n                alert('Failed to delete profile. Please try again.');\r\n            }\r\n        }\r\n    };\r\n\r\n    if (error) return <div>{error}</div>; // Show any error messages\r\n\r\n    return (\r\n        <div className=\"profile-container\">\r\n            <h1 className=\"profile-heading\">My Profile</h1>\r\n            <div className=\"profile-card\">\r\n                {!editMode ? (\r\n                    <div className=\"profile-view\">\r\n                        <p><strong>Username:</strong> {profile?.username}</p>\r\n                        <p><strong>Email:</strong> {profile?.email}</p>\r\n                        <p><strong>Full Name:</strong> {profile?.full_name}</p>\r\n                        <p><strong>Address:</strong> {profile?.address}</p>\r\n                        <p><strong>Phone Number:</strong> {profile?.phone_number}</p>\r\n                        <div className=\"button-group\">\r\n                            <button className=\"btn edit-btn\" onClick={() => setEditMode(true)}>\r\n                                Edit Profile\r\n                            </button>\r\n                            <button className=\"btn delete-btn\" onClick={handleDeleteProfile}>\r\n                                Delete Profile\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"profile-edit\">\r\n                        <input\r\n                            type=\"text\"\r\n                            name=\"username\"\r\n                            value={formData.username || ''}\r\n                            onChange={handleInputChange}\r\n                            placeholder=\"Username\"\r\n                            className=\"form-input\"\r\n                        />\r\n                        <input\r\n                            type=\"email\"\r\n                            name=\"email\"\r\n                            value={formData.email || ''}\r\n                            onChange={handleInputChange}\r\n                            placeholder=\"Email\"\r\n                            className=\"form-input\"\r\n                        />\r\n                        <input\r\n                            type=\"text\"\r\n                            name=\"full_name\"\r\n                            value={formData.full_name || ''}\r\n                            onChange={handleInputChange}\r\n                            placeholder=\"Full Name\"\r\n                            className=\"form-input\"\r\n                        />\r\n                        <textarea\r\n                            name=\"address\"\r\n                            value={formData.address || ''}\r\n                            onChange={handleInputChange}\r\n                            placeholder=\"Address\"\r\n                            className=\"form-textarea\"\r\n                        />\r\n                        <input\r\n                            type=\"text\"\r\n                            name=\"phone_number\"\r\n                            value={formData.phone_number || ''}\r\n                            onChange={handleInputChange}\r\n                            placeholder=\"Phone Number\"\r\n                            className=\"form-input\"\r\n                        />\r\n                        <div className=\"button-group\">\r\n                            <button className=\"btn save-btn\" onClick={handleUpdateProfile}>\r\n                                Save Changes\r\n                            </button>\r\n                            <button className=\"btn cancel-btn\" onClick={() => setEditMode(false)}>\r\n                                Cancel\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default ProfilePage;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}